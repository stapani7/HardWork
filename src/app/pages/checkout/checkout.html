<main class="checkout-container">
  <h1>Finalização de Compra</h1>

  <section class="cart-summary">
    <h2>Resumo do Carrinho</h2>

    <div *ngIf="cartItems.length; else vazio">

      <div class="cart-item" *ngFor="let item of cartItems; let i = index">
        <img [src]="item.imagem || 'assets/img/placeholder.png'" alt="{{ item.nome }}">
        
        <div class="cart-item-info">
          <h4>{{ item.nome }}</h4>
          <p>R$ {{ item.preco | number:'1.2-2' }}</p>
        </div>

        <!-- botão de remover -->
        <button type="button" class="remove-btn" (click)="removerDoCarrinho(i)">
          Remover
        </button>
      </div>

      <div class="cart-total">
        <span>Total:</span>
        <span>R$ {{ totalValor | number:'1.2-2' }}</span>
      </div>
    </div>

    <ng-template #vazio>
      <p>O carrinho está vazio.</p>
    </ng-template>
  </section>

  <section class="checkout-form">
    <h2>Dados do destinatário</h2>
    <label>Nome completo</label>
    <input type="text" placeholder="Nome completo" [(ngModel)]="nome" name="nome">

    <h2>Endereço</h2>
    <label>CEP</label>
    <div style="display:flex; gap:8px; align-items:center;">
      <input type="text" placeholder="CEP (somente números)" [(ngModel)]="cep" name="cep" maxlength="9"
             (blur)="buscarCep()">
      <button class="btnCep" type="button" (click)="buscarCep()" [disabled]="buscandoCep">
        {{ buscandoCep ? 'Buscando...' : 'Buscar CEP' }}
      </button>
    </div>
    <div class="cep-error" *ngIf="cepErro">{{ cepErro }}</div>

    <label>Logradouro (rua)</label>
    <input type="text" [value]="logradouro" readonly>

    <label>Bairro</label>
    <input type="text" [value]="bairro" readonly>

    <label>Cidade</label>
    <input type="text" [value]="cidade" readonly>

    <label>UF</label>
    <input type="text" [value]="uf" readonly>

    <label>Número</label>
    <input type="text" placeholder="Número" [(ngModel)]="numero" name="numero">

    <label>Complemento (opcional)</label>
    <input type="text" placeholder="Apartamento, bloco, etc." [(ngModel)]="complemento" name="complemento">

    <div class="form-error" *ngIf="geralErro">{{ geralErro }}</div>

    <button class="confirm-btn" (click)="confirmarCompra()">Confirmar Compra</button>

  </section>
</main>
